<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>What is the relationship really? - Lesan</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./css/animation-bench.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="getting_start.html"><strong aria-hidden="true">2.</strong> Getting start</a></li><li class="chapter-item expanded "><a href="add_relation.html"><strong aria-hidden="true">3.</strong> Add relation</a></li><li class="chapter-item expanded "><a href="add_more_relation.html"><strong aria-hidden="true">4.</strong> Add more relation</a></li><li class="chapter-item expanded "><a href="mannage_relations.html"><strong aria-hidden="true">5.</strong> Mannage relations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="add_relation_fn.html"><strong aria-hidden="true">5.1.</strong> addRelation function</a></li><li class="chapter-item expanded "><a href="remove_relation_fn.html"><strong aria-hidden="true">5.2.</strong> removeRelation function</a></li><li class="chapter-item expanded "><a href="what_is_the_relationship.html" class="active"><strong aria-hidden="true">5.3.</strong> What is the relationship really?</a></li></ol></li><li class="chapter-item expanded "><a href="findOne_and_find_fn.html"><strong aria-hidden="true">6.</strong> findOne and find functions</a></li><li class="chapter-item expanded "><a href="aggregation_fn.html"><strong aria-hidden="true">7.</strong> aggregation functions</a></li><li class="chapter-item expanded "><a href="find_one_and_update_functions.html"><strong aria-hidden="true">8.</strong> findOneAndUpdate functions</a></li><li class="chapter-item expanded "><a href="delete_one_fn.html"><strong aria-hidden="true">9.</strong> deleteOne functions</a></li><li class="chapter-item expanded "><a href="insert_many_fn.html"><strong aria-hidden="true">10.</strong> insertMany functions</a></li><li class="chapter-item expanded "><a href="playground.html"><strong aria-hidden="true">11.</strong> Playground</a></li><li class="chapter-item expanded "><a href="all_advantages_of_lesan.html"><strong aria-hidden="true">12.</strong> All the advantages of Lesan</a></li><li class="chapter-item expanded affix "><li class="part-title">Advanced Guide</li><li class="chapter-item expanded "><a href="an_advanced_project.html"><strong aria-hidden="true">13.</strong> Implement an advanced project</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="advanced_general_description.html"><strong aria-hidden="true">13.1.</strong> General description</a></li><li class="chapter-item expanded "><a href="advanced_nx_config.html"><strong aria-hidden="true">13.2.</strong> nx configuration</a></li><li class="chapter-item expanded "><a href="folder_structure.html"><strong aria-hidden="true">13.3.</strong> Folder Structure</a></li><li class="chapter-item expanded "><a href="microservice-monolithic.html"><strong aria-hidden="true">13.4.</strong> Microservice or Monolithic</a></li></ol></li><li class="chapter-item expanded "><a href="manage_replica.html"><strong aria-hidden="true">14.</strong> Manage replica</a></li><li class="chapter-item expanded affix "><li class="part-title">Lesan Philosophy</li><li class="chapter-item expanded "><a href="Receiving_Data.html"><strong aria-hidden="true">15.</strong> Receiving Data</a></li><li class="chapter-item expanded "><a href="Previous_methods_and_the_main_challenge.html"><strong aria-hidden="true">16.</strong> Previous methods and the main challenge</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Lesan's_Solution_For_How_To_Communicate_Between_The_Server_And_The_Client.html"><strong aria-hidden="true">16.1.</strong> Lesan's Solution For How To Communicate Between The Server And The Client</a></li><li class="chapter-item expanded "><a href="Why_NoSQL.html"><strong aria-hidden="true">16.2.</strong> Why noSQL?</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Penetration_Into_Depths.html"><strong aria-hidden="true">16.2.1.</strong> Penetration Into Depths</a></li></ol></li><li class="chapter-item expanded "><a href="Microservice.html"><strong aria-hidden="true">16.3.</strong> Microservice</a></li><li class="chapter-item expanded "><a href="Lesan_solution.html"><strong aria-hidden="true">16.4.</strong> Lesan solution</a></li></ol></li><li class="chapter-item expanded "><a href="Starting_work_with_Lesan.html"><strong aria-hidden="true">17.</strong> Starting work with Lesan</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Microservice_Architecture_with_Lesan.html"><strong aria-hidden="true">17.1.</strong> Microservice Architecture with Lesan</a></li></ol></li><li class="chapter-item expanded "><a href="Structures.html"><strong aria-hidden="true">18.</strong> Structures</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Schemas.html"><strong aria-hidden="true">18.1.</strong> Schemas</a></li><li class="chapter-item expanded "><a href="Pure_Structure_In_Schema.html"><strong aria-hidden="true">18.2.</strong> Pure Structure In Schema</a></li><li class="chapter-item expanded "><a href="The_InRelation_Structure_In_Schema.html"><strong aria-hidden="true">18.3.</strong> The InRelation Structure In Schema</a></li><li class="chapter-item expanded "><a href="The_structure_of_OutRelation_in_the_schema.html"><strong aria-hidden="true">18.4.</strong> The structure of OutRelation in the schema</a></li><li class="chapter-item expanded "><a href="The_structure_of_embed_in_the_schema.html"><strong aria-hidden="true">18.5.</strong> The structure of embed in the schema</a></li><li class="chapter-item expanded "><a href="The_structure_of_Struct_in_the_schema.html"><strong aria-hidden="true">18.6.</strong> The structure of Struct in the schema</a></li><li class="chapter-item expanded "><a href="runServer_(web_server_structure).html"><strong aria-hidden="true">18.7.</strong> runServer (web server structure)</a></li><li class="chapter-item expanded "><a href="Request_processing.html"><strong aria-hidden="true">18.8.</strong> Request processing</a></li><li class="chapter-item expanded "><a href="Dynamic_structure.html"><strong aria-hidden="true">18.9.</strong> Dynamic structure</a></li><li class="chapter-item expanded "><a href="Static_structure.html"><strong aria-hidden="true">18.10.</strong> Static structure</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">API Reference</li><li class="chapter-item expanded "><a href="api/lesan_fn.html"><strong aria-hidden="true">19.</strong> lesan</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/schemas/schemas_fn.html"><strong aria-hidden="true">19.1.</strong> schemas</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/schemas/schemaFns/schemaFns_fn.html"><strong aria-hidden="true">19.1.1.</strong> schemaFns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/schemas/schemaFns/getSchemas_fn.html"><strong aria-hidden="true">19.1.1.1.</strong> getSchemas</a></li><li class="chapter-item expanded "><a href="api/schemas/schemaFns/getPureOfMainRelations_fn.html"><strong aria-hidden="true">19.1.1.2.</strong> getPureOfMainRelations</a></li><li class="chapter-item expanded "><a href="api/schemas/schemaFns/getSchema_fn.html"><strong aria-hidden="true">19.1.1.3.</strong> getSchema</a></li><li class="chapter-item expanded "><a href="api/schemas/schemaFns/getPureSchema_fn.html"><strong aria-hidden="true">19.1.1.4.</strong> getPureSchema</a></li><li class="chapter-item expanded "><a href="api/schemas/schemaFns/getPureFromMainRelations_fn.html"><strong aria-hidden="true">19.1.1.5.</strong> getPureFromMainRelations</a></li><li class="chapter-item expanded "><a href="api/schemas/schemaFns/getPureFromRelatedRelations_fn.html"><strong aria-hidden="true">19.1.1.6.</strong> getPureFromRelatedRelations</a></li><li class="chapter-item expanded "><a href="api/schemas/schemaFns/createEmbedded_fn.html"><strong aria-hidden="true">19.1.1.7.</strong> createEmbedded</a></li><li class="chapter-item expanded "><a href="api/schemas/schemaFns/createStruct_fn.html"><strong aria-hidden="true">19.1.1.8.</strong> createStruct</a></li><li class="chapter-item expanded "><a href="api/schemas/schemaFns/_fn.html"><strong aria-hidden="true">19.1.1.9.</strong> getSchemasKeys</a></li></ol></li><li class="chapter-item expanded "><a href="api/schemas/mainRelationsFns/mainRelations_Fns.html"><strong aria-hidden="true">19.1.2.</strong> mainRelationsFns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/schemas/mainRelationsFns/getMainRelations_fn.html"><strong aria-hidden="true">19.1.2.1.</strong> getMainRelations</a></li></ol></li><li class="chapter-item expanded "><a href="api/schemas/relatedRelationFns/relatedRelation_Fns.html"><strong aria-hidden="true">19.1.3.</strong> relatedRelationFns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/schemas/relatedRelationFns/getRelatedRelations_fn.html"><strong aria-hidden="true">19.1.3.1.</strong> getRelatedRelations</a></li></ol></li><li class="chapter-item expanded "><a href="api/schemas/pureFns/pure_Fns.html"><strong aria-hidden="true">19.1.4.</strong> pureFns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/schemas/pureFns/addPureModel_Fns.html"><strong aria-hidden="true">19.1.4.1.</strong> addPureModel</a></li><li class="chapter-item expanded "><a href="api/schemas/pureFns/getPureModel_Fns.html"><strong aria-hidden="true">19.1.4.2.</strong> getPureModel</a></li><li class="chapter-item expanded "><a href="api/schemas/pureFns/getPureModelByNameAndKey_Fns.html"><strong aria-hidden="true">19.1.4.3.</strong> getPureModelByNameAndKey</a></li></ol></li><li class="chapter-item expanded "><a href="api/schemas/relationFns/relation_Fns.html"><strong aria-hidden="true">19.1.5.</strong> relationFns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/schemas/relationFns/getRelation_Fns.html"><strong aria-hidden="true">19.1.5.1.</strong> getRelation</a></li></ol></li><li class="chapter-item expanded "><a href="api/schemas/selectStructFns/selectStruct_Fns.html"><strong aria-hidden="true">19.1.6.</strong> selectStructFns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/schemas/selectStructFns/fieldType_Fns.html"><strong aria-hidden="true">19.1.6.1.</strong> fieldType</a></li><li class="chapter-item expanded "><a href="api/schemas/selectStructFns/decreaseIterate_Fns.html"><strong aria-hidden="true">19.1.6.2.</strong> decreaseIterate</a></li><li class="chapter-item expanded "><a href="api/schemas/selectStructFns/checkRelation_Fns.html"><strong aria-hidden="true">19.1.6.3.</strong> checkRelation</a></li><li class="chapter-item expanded "><a href="api/schemas/selectStructFns/selectStruct_Fns.html"><strong aria-hidden="true">19.1.6.4.</strong> selectStruct</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="api/acts/acts_fn.html"><strong aria-hidden="true">19.2.</strong> acts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/acts/setAct/setAct_Fns.html"><strong aria-hidden="true">19.2.1.</strong> setAct</a></li><li class="chapter-item expanded "><a href="api/acts/getServiceKeys/getServiceKeys_Fns.html"><strong aria-hidden="true">19.2.2.</strong> getServiceKeys</a></li><li class="chapter-item expanded "><a href="api/acts/getActs/getActs_Fns.html"><strong aria-hidden="true">19.2.3.</strong> getActs</a></li><li class="chapter-item expanded "><a href="api/acts/getActsKeys/getActsKeys_Fns.html"><strong aria-hidden="true">19.2.4.</strong> getActsKeys</a></li><li class="chapter-item expanded "><a href="api/acts/getAct/getAct_Fns.html"><strong aria-hidden="true">19.2.5.</strong> getAct</a></li><li class="chapter-item expanded "><a href="api/acts/getAtcsWithServices/getAtcsWithServices_Fns.html"><strong aria-hidden="true">19.2.6.</strong> getAtcsWithServices</a></li><li class="chapter-item expanded "><a href="api/acts/getMainActs/getMainActs_Fns.html"><strong aria-hidden="true">19.2.7.</strong> getMainActs</a></li><li class="chapter-item expanded "><a href="api/acts/getMainAct/getMainAct_Fns.html"><strong aria-hidden="true">19.2.8.</strong> getMainAct</a></li><li class="chapter-item expanded "><a href="api/acts/setService/setService_Fns.html"><strong aria-hidden="true">19.2.9.</strong> setService</a></li><li class="chapter-item expanded "><a href="api/acts/getService/getService_Fns.html"><strong aria-hidden="true">19.2.10.</strong>   getService</a></li></ol></li><li class="chapter-item expanded "><a href="api/odm/odm_fn.html"><strong aria-hidden="true">19.3.</strong> odm</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/odm/setDb/setDb_Fns.html"><strong aria-hidden="true">19.3.1.</strong> setDb</a></li><li class="chapter-item expanded "><a href="api/odm/getCollection/getCollection_Fns.html"><strong aria-hidden="true">19.3.2.</strong> getCollection</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/newModel_Fns.html"><strong aria-hidden="true">19.3.3.</strong> newModel</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/odm/newModel/find_Fns.html"><strong aria-hidden="true">19.3.3.1.</strong> find</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/findOne_Fns.html"><strong aria-hidden="true">19.3.3.2.</strong> findOne</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/insertOne_Fns.html"><strong aria-hidden="true">19.3.3.3.</strong> insertOne</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/insertMany_Fns.html"><strong aria-hidden="true">19.3.3.4.</strong> insertMany</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/addRelation_Fns.html"><strong aria-hidden="true">19.3.3.5.</strong> addRelation</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/removeRelation_Fns.html"><strong aria-hidden="true">19.3.3.6.</strong> removeRelation</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/findOneAndUpdate_Fns.html"><strong aria-hidden="true">19.3.3.7.</strong> findOneAndUpdate</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/deleteOne_Fns.html"><strong aria-hidden="true">19.3.3.8.</strong> deleteOne</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/aggregation_Fns.html"><strong aria-hidden="true">19.3.3.9.</strong> aggregation</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="api/context/contextFns_fn.html"><strong aria-hidden="true">19.4.</strong> contextFns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/context/getContextModel/getContextModel_Fns.html"><strong aria-hidden="true">19.4.1.</strong> getContextModel</a></li><li class="chapter-item expanded "><a href="api/context/setContext/setContext_Fns.html"><strong aria-hidden="true">19.4.2.</strong> setContext</a></li><li class="chapter-item expanded "><a href="api/context/getContextModel/addContexts_Fns.html"><strong aria-hidden="true">19.4.3.</strong> addContexts</a></li><li class="chapter-item expanded "><a href="api/context/getContextModel/addReqToContext_Fns.html"><strong aria-hidden="true">19.4.4.</strong> addReqToContext</a></li><li class="chapter-item expanded "><a href="api/context/getContextModel/addHeaderToContext_Fns.html"><strong aria-hidden="true">19.4.5.</strong> addHeaderToContext</a></li><li class="chapter-item expanded "><a href="api/context/getContextModel/addBodyToContext_Fns.html"><strong aria-hidden="true">19.4.6.</strong> addBodyToContext</a></li></ol></li><li class="chapter-item expanded "><a href="api/runServer/runServer_fn.html"><strong aria-hidden="true">19.5.</strong> runServer</a></li><li class="chapter-item expanded "><a href="api/generateSchema/generateSchemTypes_fn.html"><strong aria-hidden="true">19.6.</strong> generateSchemTypes</a></li></ol></li><li class="chapter-item expanded "><a href="api/types/main.html"><strong aria-hidden="true">20.</strong> types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/types/schema/main.html"><strong aria-hidden="true">20.1.</strong> schema types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/types/schema/model.html"><strong aria-hidden="true">20.1.1.</strong> model types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/types/schema/model/TRelation.html"><strong aria-hidden="true">20.1.1.1.</strong> TRelation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/types/schema/model/TRelation/RelationDataType.html"><strong aria-hidden="true">20.1.1.1.1.</strong> RelationDataType</a></li><li class="chapter-item expanded "><a href="api/types/schema/model/TRelation/RelationSortOrderType.html"><strong aria-hidden="true">20.1.1.1.2.</strong> RelationSortOrderType</a></li><li class="chapter-item expanded "><a href="api/types/schema/model/TRelation/TRelatedRelation.html"><strong aria-hidden="true">20.1.1.1.3.</strong> TRelatedRelation</a></li></ol></li><li class="chapter-item expanded "><a href="api/types/schema/model/IMainRelation.html"><strong aria-hidden="true">20.1.1.2.</strong> IMainRelation</a></li><li class="chapter-item expanded "><a href="api/types/schema/model/IRelatedRelation.html"><strong aria-hidden="true">20.1.1.3.</strong> IRelatedRelation</a></li></ol></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Lesan</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/MiaadTeam/lesan" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/MiaadTeam/lesan/tree/main/pages/src/what_is_the_relationship.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="what-is-the-relationship-really"><a class="header" href="#what-is-the-relationship-really">What is the relationship really?</a></h1>
<p>Let's compare a bit, it may be funny, but let's do it.</p>
<p>what are a real relationship between <code>People</code>?</p>
<ul>
<li>Right relationships are lasting and long -term.</li>
<li>Both parties accept responsibility for relationships and changes.</li>
<li>Changes on one side of the relationship also affect the other side.</li>
<li>The two sides of a relationship live together.</li>
<li>If the relationship leads to the birth of a child, both parties will accept the relationship.</li>
</ul>
<p>Now let's look at the relationship features in <code>SQL</code>:</p>
<ul>
<li>There is no real relationship. The two sides have only one connection.</li>
<li>Relationships are not together. And each lives independently.</li>
<li>Relationships are not deep.</li>
<li>Relationships do not give birth to any children. (In <strong>Lesan</strong>, you will see that relationships encourage you to create new models)</li>
</ul>
<p>What are the relationships in <code>NoSQL</code>?</p>
<ul>
<li>There is no real relationship. In fact, there is no proper connection between the two sides.</li>
<li>If we consider embeding as a relationship: 
<ul>
<li>the changes of each party have no effect on the other side and cause many inconsistencies in the data.</li>
<li>the two sides leave each other after the relationship.</li>
</ul>
</li>
<li>In this type of databases, they prevent the child from being born, and if a child is born, only one side will be informed of it and probably will not take much responsibility for it.</li>
</ul>
<p>And finally what are the relationships in <code>Lesan</code>:</p>
<ul>
<li>Relationships are as strong as possible, and are described in detail when creating a model.</li>
<li>Relationships fully contain each other's pure properties within themselves.</li>
<li>If a relationship changes, all related parties will be notified and apply the changes according to a process.</li>
<li>By establishing a relationship and seeing many changes on one side of this relationship, you are encouraged to create new relationships. Don't worry, this issue will not add more complexity to the data model, but it will also make the data more understandable. (Below there is an example to understand this)</li>
</ul>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<h3 id="sql"><a class="header" href="#sql">SQL</a></h3>
<p>So let's go back to our example (countries, cities and users)<br />
If we want to define a relationship between the country, city and user models in <code>SQL</code>, this relationship will be as follows (The code below is written for <code>PostgreSQL</code>):</p>
<pre><code class="language-sql">CREATE TABLE country (
  id serial PRIMARY KEY,
  name VARCHAR ( 50 ) UNIQUE NOT NULL,
  abb VARCHAR ( 50 ) NOT NULL,
  population INT NOT NULL,
);

CREATE TABLE city (
  id serial PRIMARY KEY,
  name VARCHAR ( 50 ) UNIQUE NOT NULL,
  abb VARCHAR ( 50 ) NOT NULL,
  population INT NOT NULL,
  country_id INT NOT NULL,
  FOREIGN KEY (country_id)
    REFERENCES country (country_id),
);

CREATE TABLE user (
  id serial PRIMARY KEY,
  name VARCHAR ( 50 ) UNIQUE NOT NULL,
  age INT NOT NULL,
  country_id INT NOT NULL,
  FOREIGN KEY (country_id)
    REFERENCES country (country_id),
  city_id INT NOT NULL,
  FOREIGN KEY (city_id)
    REFERENCES city_id (city_id),
);

</code></pre>
<p>Pay attention that the relationships are separated from each other as much as possible and only one ID is kept on one side. Whenever we need to know the details of the relationship, we have to visit both sides of the relationship.<br />
For example, let's imagine that we want the cities of Iran, we must first find Iran and then filter the city using Iran ID.<br />
Now let's imagine that we want to find the country of Iran along with its 50 most populated cities, we have to find Iran first, then find the cities according to the ID filter of the country of Iran along with the sort based on the city population field and the limit of 50.<br />
Let's run a more complex query. Suppose we want to receive 50 most populous cities from the 50 most populous countries in the world.<br />
Or we want to find the oldest people in the 50 most populous countries in the world.<br />
To get the above cities or users, we have to create and execute much more complex queries that may be time-consuming in some cases, although there are alternative ways such as creating separate tables in SQL for these specific purposes, but these ways also add a lot of complexity to the project.</p>
<h3 id="nosql"><a class="header" href="#nosql">NoSQL</a></h3>
<p>What if we could do the above with just a simple query? <code>NoSQL</code> is designed for this, let's see how these tables are implemented in <code>NoSQL</code> databases (Here we have used <code>mongoose</code> so that we can have the shape of the schemas):</p>
<pre><code class="language-ts">const CountrySchema = new mongoose.Schema ({
	name: String,
	abb: String,
	population: Number,
});
const Country = mongoose.model(&quot;Country&quot;, CountrySchema)

const CitySchema = new mongoose.Schema ({
	name: String,
	abb: String,
	population: Number,
	country: {
		type: mongoose.Schema.Types.ObjectId,
		ref: Country
	} 
});
const City = mongoose.model(&quot;City&quot;, CitySchema)

const UserSchema = new mongoose.Schema ({
	name: String,
	age: Number,
	country: {
		type: mongoose.Schema.Types.ObjectId,
		ref: Country
	},
	city: {
		type: mongoose.Schema.Types.ObjectId,
		ref: City
	} 
});
const User = mongoose.model(&quot;User&quot;, CitySchema)
</code></pre>
<p>The code above is exactly equivalent to the code we wrote for <code>PostgreSQL</code> and creates exactly the same tables in <code>MongoDB</code>. All the issues we described for <code>SQL</code> will be present here as well, but wait, we can add other fields to these tables to simplify the complex queries we talked about above.</p>
<p>We can store its cities inside each country by adding a field called cities. Pay attention to the following code:</p>
<pre><code class="language-ts">const CountrySchema = new mongoose.Schema ({
  name: String,
  abb: String,
  population: Number,
  cities: [{
    name: String,
    abb: String,
    population: Number,
  }]
});
</code></pre>
<p>Now we can get a country along with its cities just by sending a single query. For example, we can get the country of Iran along with its cities with just one query from the database. But wait, some new issues have arisen.</p>
<ul>
<li>How should we save the cities inside the country ?<br />
For this, it is necessary to find the country associated with the city in the function we write to add the city and add this new city to the cities field of that country. This means that when adding a city in the table of cities, we must insert a new record and edit a record in the table of countries.</li>
<li>Can we store all the cities of a country within itself ?<br />
The short answer is no, although it is possible that the number of cities in a country can be stored within the country, but in some situations, the number of documents that we need to store inside another document may be very large, such as the users of a country. So what should we do? Save a limited number of cities, how many? The number that we feel should be requested in the first pagination (for example, 50 numbers). So, in the function we have written to store the city, we must be aware that if the field of cities within the country has stored 50 cities within itself, do not add this new city to this field.</li>
<li>What if a city changes ?<br />
Well, as a rule, we should find the country related to that city and check whether this city is stored in the field of cities of that country or not, if yes, we should correct it.</li>
<li>What if a city is removed ?<br />
We need to find the country associated with the city and if this city is present in the field of cities of that country, we should modify that field as well. How? First, we remove this city from the array of cities, then we check whether this field has reached the limited number that we have previously considered for it, if yes, then this country may have other cities that are not in this field. So we need to find one of them and add it to this field.</li>
</ul>
<p>All this was added just so that we can have its cities when receiving a country!<br />
Don't worry, it's worth it. Because we usually add cities and countries once, besides, its information does not change much (except for the population, which we will talk about later). And on the other hand, these cities and countries will be received many times.</p>
<p>Now, what if we want to get the 50 most populous countries along with the 50 most populous cities of that country?<br />
We can add a new field to the country. Pay attention to the following code:</p>
<pre><code class="language-ts">const CountrySchema = new mongoose.Schema ({
  name: String,
  abb: String,
  population: Number,
  cities: [{
    name: String,
    abb: String,
    population: Number,
  }],
  mostPopulousCities: [{
    name: String,
    abb: String,
    population: Number,
  }],
});
</code></pre>
<p>For <code>mostPopulousCities</code> Field, we should consider all the events that happened above, although with a slight change:</p>
<ul>
<li>What if a city changes ?
We need to find the country associated with the city, then see if this city is stored in the <code>cities</code> and <code>mostPopulousCities</code> fields of this country or not. If it is stored in the <code>cities</code> field, we must do the same steps as above, but if it is stored in the <code>mostPopulousCities</code> field, we must first, see which city field has changed, if the population field has changed, this city may no longer be included in this list and we want to remove it from the list and add another city to this list based on its population, otherwise it is possible This city is not in the <code>mostPopulousCities</code> list at all, but due to the change in the city's population, we want to add it to this list. Note that this city may be added anywhere in this list, and on the other hand, if this list has reached the end of the predetermined capacity, we must remove a city from the end.</li>
</ul>
<h3 id="lesan"><a class="header" href="#lesan">Lesan</a></h3>
<p>So, if we want to create the same relationships with <strong>‌Lesan</strong>, what should we do?
Just enter the code below:</p>
<pre><code class="language-ts">// Country Model
const countryCityPure = {
  name: string(),
  population: number(),
  abb: string(),
};

const countryRelations = {};

const countries = coreApp.odm.newModel(
  &quot;country&quot;,
  countryCityPure,
  countryRelations,
);

// City Model
const cityRelations = {
  country: {
    optional: false,
    schemaName: &quot;country&quot;,
    type: &quot;single&quot; as RelationDataType,
    relatedRelations: {
      cities: {
        type: &quot;multiple&quot; as RelationDataType,
        limit: 50,
        sort: {
          field: &quot;_id&quot;,
          order: &quot;desc&quot; as RelationSortOrderType,
        },
      },
      mostPopulousCities: {
        type: &quot;multiple&quot; as RelationDataType,
        limit: 50,
        sort: {
          field: &quot;population&quot;,
          order: &quot;desc&quot; as RelationSortOrderType,
        },
      },
    },
  },
};

const cities = coreApp.odm.newModel(
  &quot;city&quot;,
  countryCityPure,
  cityRelations,
);

// User Model
const userPure = {
  name: string(),
  age: number(),
};

const userRelations = {
  country: {
    optional: false,
    schemaName: &quot;country&quot;,
    type: &quot;single&quot; as RelationDataType,
    relatedRelations: {
      users: {
        type: &quot;multiple&quot; as RelationDataType,
        limit: 50,
        sort: {
          field: &quot;_id&quot;,
          order: &quot;desc&quot; as RelationSortOrderType,
        },
      },
    },
  },
  city: {
    optional: false,
    schemaName: &quot;country&quot;,
    type: &quot;single&quot; as RelationDataType,
    relatedRelations: {
      users: {
        type: &quot;multiple&quot; as RelationDataType,
        limit: 50,
        sort: {
          field: &quot;_id&quot;,
          order: &quot;desc&quot; as RelationSortOrderType,
        },
      },
    },
  },
};

const users = coreApp.odm.newModel(
  &quot;user&quot;,
  userPure,
  userRelations,
);
</code></pre>
<p>In the code above, we have not defined any relationship for the country, but in fact, the country is related to both the city and the user, but this relationship is defined by them because they were the requesters of the relationship.<br />
If you pay attention, we have defined two <code>relatedRelations</code> for the country when defining city relations, which causes two fields called <code>cities</code> and <code>mostPopulousCities</code> to be added to the country schema. For the <code>cities</code> field, we have set the sort on <code>_id</code> and in <code>descending</code> order, and we have limited the capacity of the field to 50 numbers with the <code>limit</code> option, which causes the last 50 cities of each country to be stored in it.<br />
But in the <code>mostPopulousCities</code> field we have once again stored 50 cities in each country, but this time by sorting on the City <code>population</code> field.<br />
The important thing here is that all the things we said we need to do in <code>NoSQL</code> databases using <code>Mongoose</code> are done automatically in <code>Lesan</code> and you don't need any additional code to manage these relationships during <code>insert</code>, <code>update</code> or <code>delete</code>. All work will be done by <code>Lesan</code>.</p>
<h2 id="test-realation-in-lesan"><a class="header" href="#test-realation-in-lesan">Test Realation in Lesan</a></h2>
<h3 id="clone-and-run-e2e"><a class="header" href="#clone-and-run-e2e">Clone and run E2E</a></h3>
<p>you can clone lesan repo by <code>git clone https://github.com/MiaadTeam/lesan.git</code> command and the go to <code>tests/playground</code> folder and run <code>e2e.ts</code> file by execute this command: <code>deno run -A e2e.ts</code> you should see this output:</p>
<pre><code class="language-shell">HTTP webserver running.
please send a post request to http://localhost:1366/lesan
you can visit playground on http://localhost:1366/playground

Listening on http://localhost:1366/
</code></pre>
<h3 id="visit-playground"><a class="header" href="#visit-playground">Visit Playground</a></h3>
<p>Now you can visit the <code>playground</code> at <code>http://localhost:1366/playground</code> and send requests to the server for <code>country</code>, <code>city</code>, and <code>user</code> models:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/668ad7d6-70aa-4720-a33c-9bbc417cf579" alt="Screenshot 2023-12-31 at 21-35-56 Lesan Playground" /></p>
<p>and use <code>addCountry</code>, <code>addCountries</code>, <code>updateCountry</code>, <code>getCountries</code>, <code>deleteCountry</code> methods for country models:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/4ef81e63-4eb7-4852-a6e7-92e91e0e3716" alt="Screenshot 2023-12-31 at 21-42-37 Lesan Playground" /> </p>
<p>also use <code>addCity</code>, <code>updateCity</code>, <code>addCities</code>, <code>getCities</code> and <code>addCityCountry</code> for city model:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/caf69ec5-44fc-4f14-82fd-335e87a04b38" alt="Screenshot 2023-12-31 at 22-03-07 Lesan Playground" /></p>
<p>and also use <code>addUser</code>, <code>addUsers</code>, <code>addUserLivedCities</code>, <code>addUserCountry</code>, <code>addUserCities</code>, <code>addMostLovedCity</code>, <code>removeMostLovedCity</code>, <code>removeLivedCities</code>, <code>updateUser</code>, <code>getUser</code> and <code>getUsers</code> for user model:</p>
<p><img src="https://github.com/MiaadTeam/lesan/assets/6236123/2f6fddac-685e-4f2b-9923-9a43fa1d13fa" alt="Screenshot 2023-12-31 at 22-06-53 Lesan Playground" />
you can find <code>e2e.ts</code> raw file <a href="https://raw.githubusercontent.com/MiaadTeam/lesan/main/tests/playground/e2e.ts">here</a> and see all functions write in it.</p>
<h3 id="visit-schema-and-act"><a class="header" href="#visit-schema-and-act">Visit Schema and Act</a></h3>
<p>You can see all <code>schema</code> information including <code>pure</code>, <code>mainRelation</code> and <code>relatedRelation</code> inside schema modal box at playground when clicking on <code>Schema</code> button:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/a4ecfb41-a356-40dd-a2e5-d3a550d17d99" alt="Screenshot 2023-12-31 at 22-33-26 Lesan Playground" /></p>
<p>here is the screenshot of schema modal box:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/b63db52d-9d15-4086-a381-c4ea06b3feac" alt="Screenshot 2023-12-31 at 22-37-13 Lesan Playground" /></p>
<p>Also you can see all <code>Act</code> information including <code>service</code>, <code>model</code>, <code>act</code> and its <code>inputs</code> such as <code>set</code> and <code>get</code> inside act modal box at playground when clicking on <code>Act</code> button:<br />
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/d0ffe5a4-15cf-4661-a535-17b66707269c" alt="Screenshot 2023-12-31 at 22-38-46 Lesan Playground" /></p>
<p>here is the screenshot of act modal box:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/d6675ced-2179-461a-98e6-3b220523de36" alt="Screenshot 2023-12-31 at 22-43-11 Lesan Playground" /></p>
<h3 id="visit-e2e-test-modal"><a class="header" href="#visit-e2e-test-modal">Visit E2E test modal</a></h3>
<p>We have already prepared several E2E test series for <code>e2e.ts</code>'s file, and you can go to E2E modal box by clicking the <code>E2E test</code> button:<br />
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/b4e870cb-bc98-40fa-8517-13e13eca30c4" alt="Screenshot 2023-12-31 at 22-52-21 Lesan Playground" /></p>
<p>here you can import E2E test config file by clicking on <code>import</code> button:<br />
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/ed500be1-9002-4558-abfe-79548301f2ef" alt="Screenshot 2023-12-31 at 22-55-06 Lesan Playground" /></p>
<p>We have these 3 <code>json</code> files next to the <code>e2e.ts</code> file, all three of which can be used for E2E testing:</p>
<ul>
<li><a href="https://raw.githubusercontent.com/MiaadTeam/lesan/main/tests/playground/Configdata.json">Configdata.json</a></li>
<li><a href="https://raw.githubusercontent.com/MiaadTeam/lesan/main/tests/playground/fakerTest.json">fakerTest.json</a></li>
<li><a href="https://raw.githubusercontent.com/MiaadTeam/lesan/main/tests/playground/stress.json">stress.json</a></li>
</ul>
<h4 id="configdata-e2e-file"><a class="header" href="#configdata-e2e-file">Configdata E2E file</a></h4>
<p>In the <code>config.json</code> file, all the functions written in <code>e2e.ts</code> have been tested.
In fact, all the important functions, including all the functions of the <code>ODM</code> section in Lesan, have been tested in this file.
Let us see all the parts of this E2E test one by one (The point is that in almost all the functions written in <code>ODM</code>, relationships are important and Lesan must manage them.):</p>
<ol>
<li>
<p>create new country with <code>main</code> → <code>country</code> → <code>addCountry</code>:<br />
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/3bf4eade-17bf-4041-b952-5bdc15dcff22" alt="Screenshot 2024-01-04 at 11-22-31 Lesan Playground" /></p>
<ol>
<li>here we used <code>main</code> service and <code>country</code> model and <code>addCountry</code> act.</li>
<li>we repeat this section 15 times.</li>
<li>we captured <code>countryId</code> from last response of this sections.</li>
<li>here we used faker for create <code>name</code>, <code>population</code> and <code>abb</code> for new country.</li>
</ol>
</li>
<li>
<p>create multiple country with one request with <code>main</code> → <code>country</code> → <code>addCountries</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/888b2299-2c85-4a68-81e0-e41b025f7514" alt="Screenshot 2024-01-04 at 13-53-29 Lesan Playground" /></p>
<ol>
<li>here we used <code>main</code> service and <code>country</code> model and <code>addCountries</code> act.</li>
<li>here we insert an array of <code>country</code> for <code>multiCountries</code> key inside <code>set</code> object.</li>
<li>we captured some country ID from request response.</li>
</ol>
</li>
<li>
<p>create new city with <code>main</code> → <code>city</code> → <code>addCity</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/f7abbf20-4e6e-4372-a936-a1a715016663" alt="Screenshot 2024-01-04 at 14-20-22 Lesan Playground" /></p>
<ol>
<li>here we used <code>iranId</code> the captured variable we get from request number 2 response. </li>
<li>we captured <code>body._id</code> with the <code>haratId</code> from response.</li>
</ol>
</li>
<li>
<p>create multiple city with <code>main</code> → <code>city</code> → <code>addCities</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/4d0de202-f206-4ab4-9888-7fdba54484e7" alt="Screenshot 2024-01-04 at 14-42-12 Lesan Playground" /></p>
<ol>
<li>here we insert an array of <code>city</code> for <code>multiCities</code> key inside <code>set</code> object.</li>
<li>here we used <code>iraqId</code> the captured variable we get from request number 2 response. </li>
</ol>
</li>
<li>
<p>create multiple city with <code>main</code> → <code>city</code> → <code>addCities</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/0f1e1049-0ac2-4306-87e2-150c36e7232f" alt="Screenshot 2024-01-04 at 14-56-21 Lesan Playground" /></p>
<ol>
<li>here we insert an array of <code>city</code> for <code>multiCities</code> key inside <code>set</code> object. We also used <code>faker</code> here.</li>
<li>here we used <code>afghanId</code> the captured variable we get from request number 2 response. </li>
</ol>
</li>
<li>
<p>change country relation of a city with <code>main</code> → <code>city</code> → <code>addCityCountry</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/7e0ec54b-2e3c-4326-acf2-0a05d2d2c461" alt="Screenshot 2024-01-04 at 15-04-46 Lesan Playground" /></p>
<ol>
<li>here we used <code>haratId</code> and <code>afghanId</code> captured variables. please check <code>mongodb compass</code> beacuase the both side of relation are changend.</li>
</ol>
</li>
<li>
<p>create new city with <code>main</code> → <code>city</code> → <code>addCity</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/674aebb7-ba96-4b63-ab6a-b5e75a6011a3" alt="Screenshot 2024-01-04 at 15-14-21 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>city</code> → <code>addCity</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/0ef9160f-d910-495d-8bee-d79f1c9cf441" alt="Screenshot 2024-01-04 at 15-17-21 Lesan Playground" /></p>
<ol>
<li>please note that we set <code>isCapital</code> field to true so the capital field of related country is filled with this city.</li>
</ol>
</li>
<li>
<p>create new city with <code>main</code> → <code>city</code> → <code>addCity</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/80cb152a-b280-4525-8a4b-85c953396921" alt="Screenshot 2024-01-04 at 16-39-21 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>city</code> → <code>addCity</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/48516d1f-318d-412d-9d5f-9be01381e8c4" alt="Screenshot 2024-01-04 at 16-42-27 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>city</code> → <code>addCity</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/aa378522-585e-4892-a4a4-65102a0b593f" alt="Screenshot 2024-01-04 at 16-43-55 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>city</code> → <code>addCity</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/dec98671-1ebb-43a6-abd1-bffba1bab111" alt="Screenshot 2024-01-04 at 16-45-38 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>city</code> → <code>addCity</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/b8ed08ef-06aa-49ae-8a06-4ad0ba3666ca" alt="Screenshot 2024-01-04 at 16-48-19 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>city</code> → <code>addCity</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/28fd00d5-7503-49b6-bf17-6d14799a6a31" alt="Screenshot 2024-01-04 at 16-50-30 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>city</code> → <code>addCity</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/a9e89d0c-f830-44f4-89d6-e5a76c44219d" alt="Screenshot 2024-01-04 at 17-04-33 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>city</code> → <code>addCity</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/677d9edf-f5a9-411f-8ad5-432b045110e4" alt="Screenshot 2024-01-04 at 17-07-41 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>city</code> → <code>addCity</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/2f44a803-21a3-49bb-8bee-b69510675a64" alt="Screenshot 2024-01-04 at 17-08-14 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>city</code> → <code>addCity</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/69362e9b-0dc5-48d3-890d-a691860daa1a" alt="Screenshot 2024-01-04 at 17-09-14 Lesan Playground" /></p>
</li>
<li>
<p>just get list of countries with <code>main</code> → <code>country</code> → <code>getCountries</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/dddb4457-2b70-417c-ac09-57c1e45b3338" alt="Screenshot 2024-01-04 at 17-10-22 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>user</code> → <code>addUser</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/0afc1e9e-bb6e-4229-9144-075c31e5a082" alt="Screenshot 2024-01-04 at 17-19-46 Lesan Playground" /></p>
<ol>
<li>the country were user lived is <code>Iran</code>.</li>
<li>the user lived in two city: <code>Hamedan</code> and <code>Tehran</code>.</li>
</ol>
</li>
<li>
<p>create new city with <code>main</code> → <code>user</code> → <code>addUser</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/b0a30977-4d78-46df-85ca-b89e9685bf3c" alt="Screenshot 2024-01-04 at 17-28-58 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>user</code> → <code>addUser</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/299ad320-3305-478b-b17b-272ad7ecd100" alt="Screenshot 2024-01-04 at 17-29-39 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>user</code> → <code>addUser</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/1064b150-329b-4137-a69f-5d1c17ec25ba" alt="Screenshot 2024-01-04 at 17-30-13 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>user</code> → <code>addUser</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/40488480-016c-4d24-8648-203e0af1952b" alt="Screenshot 2024-01-04 at 17-30-44 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>user</code> → <code>addUser</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/f1f10d1a-b368-4ef7-be7f-066977622d26" alt="Screenshot 2024-01-04 at 17-31-20 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>user</code> → <code>addUser</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/28e8833f-889b-4a11-9f33-8d7019513c8a" alt="Screenshot 2024-01-04 at 17-31-54 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>user</code> → <code>addUser</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/2d845a61-6857-48a2-aaf8-67180111869a" alt="Screenshot 2024-01-04 at 17-32-28 Lesan Playground" /></p>
</li>
<li>
<p>create new city with <code>main</code> → <code>user</code> → <code>addUser</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/c6a5b53f-19d1-464a-a42b-fa33eb8e6e4f" alt="Screenshot 2024-01-04 at 17-33-04 Lesan Playground" /></p>
</li>
<li>
<p>change country relation of a user with <code>main</code> → <code>user</code> → <code>addUserCountry</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/8eae91d9-6bd9-4d4c-a2e2-e678d53a8d70" alt="Screenshot 2024-01-04 at 19-20-28 Lesan Playground" />
1.we just send a country ID with a user ID and with a simple function all magic happen in both side of relation.</p>
</li>
<li>
<p>change country relation of a user with <code>main</code> → <code>user</code> → <code>addUserCountry</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/34c7f763-a336-4670-a8b2-94b429c6c4ac" alt="Screenshot 2024-01-04 at 19-34-16 Lesan Playground" /></p>
</li>
<li>
<p>add city to <code>livedCities</code> relation of a user with <code>main</code> → <code>user</code> → <code>addUserLivedCities</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/9401a88b-1bd6-4904-8f76-b6219e79efd8" alt="Screenshot 2024-01-04 at 19-37-00 Lesan Playground" />
1.we just send list of city ID with a user ID and with a simple function all magic happen in both side of relation.</p>
</li>
<li>
<p>add city to <code>livedCities</code> relation of a user with <code>main</code> → <code>user</code> → <code>addUserLivedCities</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/b4136fbf-58b1-42f9-bc92-b02f290d687a" alt="Screenshot 2024-01-04 at 19-51-56 Lesan Playground" /></p>
</li>
<li>
<p>remove city from <code>livedCities</code> relation of a user with <code>main</code> → <code>user</code> → <code>removeLivedCities</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/8d255bd8-94b1-4ffc-87b2-40aa57124c9b" alt="Screenshot 2024-01-04 at 19-54-10 Lesan Playground" />
1.we just send list of city ID with a user ID and with a simple function all magic happen in both side of relation.</p>
</li>
<li>
<p>add a city to <code>mostLovedCity</code> relation of a user with <code>main</code> → <code>user</code> → <code>addMostLovedCity</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/4d4a4427-8f3d-4aa7-98c9-0dd89ffcc683" alt="Screenshot 2024-01-04 at 19-59-44 Lesan Playground" /></p>
</li>
<li>
<p>add a city to <code>mostLovedCity</code> relation of a user with <code>main</code> → <code>user</code> → <code>addMostLovedCity</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/bf13f4fa-6a58-44f5-bbb5-6cceb01d25fc" alt="Screenshot 2024-01-04 at 20-05-52 Lesan Playground" /></p>
</li>
<li>
<p>remove a city from <code>mostLovedCity</code> relation of a user with <code>main</code> → <code>user</code> → <code>removeLivedCities</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/e21e0e16-23f2-4629-9ab2-5555f6b8cd4f" alt="Screenshot 2024-01-04 at 20-11-13 Lesan Playground" /></p>
</li>
<li>
<p>update a country with <code>main</code> → <code>country</code> → <code>updateCountry</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/40919290-ee9d-47b3-869a-5574273a7fc8" alt="Screenshot 2024-01-04 at 20-12-26 Lesan Playground" /></p>
<ol>
<li>We send the ID of a country along with the rest of the pure fields (pure fields are optional) to it, and in a simple function the following will happen:
<ul>
<li>Update the country itself</li>
<li>Updating the country field in all cities related to that country</li>
<li>Updating the country field in all users related to that country</li>
</ul>
</li>
</ol>
<p>The point to be mentioned here is that you should not send another field for updating other than pure fields. Because the relationships must be completely managed by Lesan himself.</p>
</li>
<li>
<p>update a city with <code>main</code> → <code>city</code> → <code>updateCity</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/c9d034e9-58c2-46fb-9a1f-05043727d969" alt="Screenshot 2024-01-04 at 20-26-49 Lesan Playground" /></p>
</li>
<li>
<p>update a user with <code>main</code> → <code>user</code> → <code>updateUser</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/44dd6ccd-de32-4457-9fb5-5e006b54142d" alt="Screenshot 2024-01-04 at 20-27-19 Lesan Playground" /></p>
</li>
</ol>
<p>After clicking the <code>run E2E test</code> button, you will go to the test results page.
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/123c7303-d100-4009-9395-f97c68683579" alt="Screenshot 2024-01-06 at 13-34-30 Lesan Playground" /></p>
<p>If you scroll down a little, you can see the results of each sequence separately:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/db59ef98-b30f-4a39-8204-dc696dbd31fa" alt="Screenshot 2024-01-06 at 14-13-04 Lesan Playground" />
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/577dd55a-8faa-4686-ad8a-4de62671c490" alt="Screenshot 2024-01-06 at 14-20-03 Lesan Playground" /></p>
<ol>
<li>with this button you can change view of panel from <code>body-header &amp; Description</code> to <code>REQUEST &amp; RESULT</code></li>
<li>show some description about sequence including request number &amp; timing, captured value and so on.</li>
<li>show unparsed <code>header</code> and <code>body</code> you send to the backend.</li>
<li>show the <code>index</code> of each sequence.</li>
<li>show <code>response</code> get back from server.</li>
<li>show parsed request you send to server, including parsed <code>header</code> and <code>body</code>.</li>
<li>pagination for sequence with more than 1 request.</li>
</ol>
<p>After finished executing all test in <code>configdata.json</code> you have a nice data inserted to <code>sample</code> collection in mongodb.
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/ca01c001-7dd9-4b99-a5d5-82ab39ee008d" alt="Screenshot from 2024-01-06 15-10-49" /></p>
<p>You can play with this data in <code>playground</code> and change everything you want.
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/4efa9e8a-ba9b-40f0-8ebe-6d5ed139fee3" alt="Screenshot 2024-01-06 at 15-08-36 Lesan Playground" /></p>
<h4 id="fakertest-e2e-file"><a class="header" href="#fakertest-e2e-file">fakerTest E2E file</a></h4>
<p>This file is not very important in this section, it is only used to test <code>faker</code> functions in <code>E2E</code>.
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/aa5108db-3d9c-45ca-8f5c-dc5b2e747cfb" alt="Screenshot 2024-01-06 at 16-47-45 Lesan Playground" /></p>
<h4 id="stress-e2e-file"><a class="header" href="#stress-e2e-file">stress E2E file</a></h4>
<p>This file is used to test the <code>insertMany</code> that has a relation with it. Note that a very large number of server-side requests are sent, resulting in the creation of a country with <code>50,000</code> cities for that country and <code>50,000</code> users for that country.</p>
<ol>
<li>
<p>create a country with <code>main</code> → <code>country</code> → <code>addCountry</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/5ec1fc1f-88b0-4ca3-b89c-f268198c47e6" alt="Screenshot 2024-01-06 at 17-33-04 Lesan Playground" /></p>
</li>
<li>
<p>create <code>50,000</code> cities with <code>main</code> → <code>city</code> → <code>addCities</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/1a82400a-1ed5-4f52-a810-7345bb536e93" alt="Screenshot 2024-01-06 at 17-35-45 Lesan Playground" /></p>
</li>
<li>
<p>create <code>50,000</code> users with <code>main</code> → <code>user</code> → <code>addUsers</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/1e6e9aa5-09f3-4777-8743-8cb129c60362" alt="Screenshot 2024-01-06 at 17-39-02 Lesan Playground" /></p>
</li>
</ol>
<p>After clicking the <code>run E2E test</code> button, <code>10001</code> requests should be sent to the server, and as a result, a country, <code>50,000</code> cities, and <code>50,000</code> users should be created.
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/f43e5a5c-e620-48a9-bbf4-399b4ef31a55" alt="Screenshot 2024-01-06 at 19-21-48 Lesan Playground" /></p>
<p>Pay attention to the entered data, although we have used <code>insertMany</code>, all relationships are embedded.<br />
In the <code>country</code>, we have embedded the <code>cities</code> in 4 fields separately and with different conditions. And we have embedded <code>users</code> in two fields with different conditions.
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/4162bcea-16f3-48a6-b927-bb083cc57fef" alt="Screenshot from 2024-01-06 19-07-59" /></p>
<p>In the <code>cities</code>, we have embedded the respective <code>country</code>.
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/4ec9a53d-5170-4f24-83d4-cb667b923546" alt="Screenshot from 2024-01-06 19-14-11" /></p>
<p>In the <code>user</code> schema, for each user, we have embedded the <code>cities</code> he has lived in as a <code>list</code>, the <code>city</code> he is most interested in as an <code>object</code>, and the <code>country</code> of each user as an <code>object</code>.
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/3c5a621b-769e-4c09-8339-e24a59af0f8a" alt="Screenshot from 2024-01-06 19-16-33" /></p>
<p>The interesting thing about this E2E test is that after the database is filled, you can test a big update in Playground. If you update the <code>country</code> in Playground, <code>100,000</code> other documents must be updated along with the country record itself.</p>
<p>before execute  <code>main</code> → <code>country</code> → <code>updateCountry</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/a36b7b04-eb8b-4833-9ba2-88bbf2291d54" alt="Screenshot from 2024-01-06 19-40-02" />
executin  <code>main</code> → <code>country</code> → <code>updateCountry</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/3e2dc448-2ff2-4c3c-ab21-e978d897c0e1" alt="Screenshot 2024-01-06 at 19-41-30 Lesan Playground" />
after execute  <code>main</code> → <code>country</code> → <code>updateCountry</code>:
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/1bd0ba8e-a031-4787-be48-cf873e6fead2" alt="Screenshot from 2024-01-06 19-41-56" /></p>
<h2 id="relationship-sweets-in-lesan"><a class="header" href="#relationship-sweets-in-lesan">relationship sweets in Lesan</a></h2>
<p>shoma tanha ba fieldhaye pure yek schema sar o kar darid va modiriat rabeteha tamaman be sorat khodkar tavasot lesan anjam mishavad.
shoma mitavanid bar asas rabeteye yek schema an ra sort ya filter konid
shoma baraye daryaft dadaha ba queryhaye pichide asnad besiyar kamtari ra az database jamavari mikonid. (link bedam be tozihat kamel)</p>
<h2 id="relationship-bitterness-in-lesan"><a class="header" href="#relationship-bitterness-in-lesan">relationship bitterness in Lesan</a></h2>
<p>barkhi az rabeteha baes eijad updatehaye besiyar bozorg mishavand. rah hal: 1-eijad rabeteye jadid 2-qq 3-in-memory db</p>
<p>اول راجع به ایمکه رابطه چی هست حرف می‌زنم، بعد می‌گم اس‌کیوال فقط کانکشن برقرار می‌کنه، بعد می‌گم نواس‌کیوال هم فقط امبد می‌کنه و مدیریت درست نداره.</p>
<p>بعد میام راجع به اینکه هر فیلد پر تغییری می‌تونه به رابطه تبدیل بشه حرف می‌زنم، مثال بانک و ثبت احوال کشورها رو می‌گم.</p>
<p>بعد میام راجع به اینکه رابطه‌های دو سر چندتایی نمی‌تونه دو سر بی انتها داشته باشه حرف می‌زنم و چندتا مثال می‌زنم.</p>
<p>بعد راجع به آپدیت شدن رابطه‌ها حرف می‌زنم.</p>
<p>بعد راجع به دیتابیس اینمموری حرف می‌زنم.</p>
<p>بعد راجع به مدیریت کیوکیو حرف می‌زنم.</p>
<p>حتما یادم باشه راجع به اینکه وقتی امبد می‌کنی چقدر دریافت داده‌ها راحت هست هم حرف بزنیم، از اون طرف راجع به اینکه فیلتر کردنشون بر اساس فیلد امبد شده چه معجزه‌ای میکنه هم حرف بزنم</p>
<p>حتما راجع به اینکه چه نکته‌هایی داره طراحی مدل توی لسان حرف بزنم یعنی اینکه بگم رابطه‌ها از یک طرف تعریف می‌شن بعد توی طرف بعدی از همینجا ساید افکت‌هاش مشخص میشه بگم و اینکه نگران نباشن چون توی پلی‌گراند می‌تونن برای یک مدل همه‌ی رابطه‌هایی که داره چه از طرف خودش تعریف شده باشه چه بقیه براش تعریف کرده باشن رو ببینه و یه عکس از پلی‌گراند بذارم، نکته مهمش اینه که بگم همیشه رابطه رو از طرف مهمش درخواست بدن تا بشه هر چقدر می‌خوایم ساید افکت مناسب براش بذاریم</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="remove_relation_fn.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="findOne_and_find_fn.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="remove_relation_fn.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="findOne_and_find_fn.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
