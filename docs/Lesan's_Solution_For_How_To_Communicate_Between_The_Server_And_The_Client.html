<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Lesan&#x27;s Solution For How To Communicate Between The Server And The Client - Lesan</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./css/animation-bench.css">
        <link rel="stylesheet" href="./css/styles.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="getting_start.html"><strong aria-hidden="true">2.</strong> Getting start</a></li><li class="chapter-item expanded "><a href="add_relation.html"><strong aria-hidden="true">3.</strong> Add relation</a></li><li class="chapter-item expanded "><a href="add_more_relation.html"><strong aria-hidden="true">4.</strong> Add more relation</a></li><li class="chapter-item expanded "><a href="mannage_relations.html"><strong aria-hidden="true">5.</strong> Mannage relations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="add_relation_fn.html"><strong aria-hidden="true">5.1.</strong> addRelation function</a></li><li class="chapter-item expanded "><a href="remove_relation_fn.html"><strong aria-hidden="true">5.2.</strong> removeRelation function</a></li><li class="chapter-item expanded "><a href="what_is_the_relationship.html"><strong aria-hidden="true">5.3.</strong> What is the relationship really?</a></li></ol></li><li class="chapter-item expanded "><a href="findOne_and_find_fn.html"><strong aria-hidden="true">6.</strong> findOne and find functions</a></li><li class="chapter-item expanded "><a href="aggregation_fn.html"><strong aria-hidden="true">7.</strong> aggregation functions</a></li><li class="chapter-item expanded "><a href="find_one_and_update_functions.html"><strong aria-hidden="true">8.</strong> findOneAndUpdate functions</a></li><li class="chapter-item expanded "><a href="delete_one_fn.html"><strong aria-hidden="true">9.</strong> deleteOne functions</a></li><li class="chapter-item expanded "><a href="insert_many_fn.html"><strong aria-hidden="true">10.</strong> insertMany functions</a></li><li class="chapter-item expanded "><a href="playground.html"><strong aria-hidden="true">11.</strong> Playground</a></li><li class="chapter-item expanded "><a href="all_advantages_of_lesan.html"><strong aria-hidden="true">12.</strong> All the advantages of Lesan</a></li><li class="chapter-item expanded affix "><li class="part-title">Advanced Guide</li><li class="chapter-item expanded "><a href="an_advanced_project.html"><strong aria-hidden="true">13.</strong> Implement an advanced project</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="advanced_general_description.html"><strong aria-hidden="true">13.1.</strong> General description</a></li><li class="chapter-item expanded "><a href="advanced_nx_config.html"><strong aria-hidden="true">13.2.</strong> nx configuration</a></li><li class="chapter-item expanded "><a href="folder_structure.html"><strong aria-hidden="true">13.3.</strong> Folder Structure</a></li><li class="chapter-item expanded "><a href="microservice-monolithic.html"><strong aria-hidden="true">13.4.</strong> Microservice or Monolithic</a></li></ol></li><li class="chapter-item expanded "><a href="manage_replica.html"><strong aria-hidden="true">14.</strong> Manage replica</a></li><li class="chapter-item expanded affix "><li class="part-title">Lesan Philosophy</li><li class="chapter-item expanded "><a href="Receiving_Data.html"><strong aria-hidden="true">15.</strong> Receiving Data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Previous_methods_and_the_main_challenge.html"><strong aria-hidden="true">15.1.</strong> Previous methods and the main challenge</a></li><li class="chapter-item expanded "><a href="Lesan's_Solution_For_How_To_Communicate_Between_The_Server_And_The_Client.html" class="active"><strong aria-hidden="true">15.2.</strong> Lesan's Solution For How To Communicate Between The Server And The Client</a></li></ol></li><li class="chapter-item expanded "><a href="Why_NoSQL.html"><strong aria-hidden="true">16.</strong> Why noSQL?</a></li><li class="chapter-item expanded "><a href="Queuing_data_changes.html"><strong aria-hidden="true">17.</strong> Queuing data changes</a></li><li class="chapter-item expanded "><a href="CSR_SSR_or_SSG_content.html"><strong aria-hidden="true">18.</strong> CSR, SSR or SSG content</a></li><li class="chapter-item expanded "><a href="Penetration_Into_Depths.html"><strong aria-hidden="true">19.</strong> Penetration Into Depths</a></li><li class="chapter-item expanded "><a href="Microservice.html"><strong aria-hidden="true">20.</strong> Microservice</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Lesan_solution.html"><strong aria-hidden="true">20.1.</strong> Lesan solution</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Structures</li><li class="chapter-item expanded "><a href="Schemas.html"><strong aria-hidden="true">21.</strong> Schemas</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Pure_Structure_In_Schema.html"><strong aria-hidden="true">21.1.</strong> Pure Structure In Schema</a></li></ol></li><li class="chapter-item expanded "><a href="The_InRelation_Structure_In_Schema.html"><strong aria-hidden="true">22.</strong> The InRelation Structure In Schema</a></li><li class="chapter-item expanded "><a href="The_structure_of_OutRelation_in_the_schema.html"><strong aria-hidden="true">23.</strong> The structure of OutRelation in the schema</a></li><li class="chapter-item expanded "><a href="The_structure_of_embed_in_the_schema.html"><strong aria-hidden="true">24.</strong> The structure of embed in the schema</a></li><li class="chapter-item expanded "><a href="The_structure_of_Struct_in_the_schema.html"><strong aria-hidden="true">25.</strong> The structure of Struct in the schema</a></li><li class="chapter-item expanded "><a href="runServer_(web_server_structure).html"><strong aria-hidden="true">26.</strong> runServer (web server structure)</a></li><li class="chapter-item expanded "><a href="Request_processing.html"><strong aria-hidden="true">27.</strong> Request processing</a></li><li class="chapter-item expanded "><a href="Dynamic_structure.html"><strong aria-hidden="true">28.</strong> Dynamic structure</a></li><li class="chapter-item expanded "><a href="Static_structure.html"><strong aria-hidden="true">29.</strong> Static structure</a></li><li class="chapter-item expanded affix "><li class="part-title">API Reference</li><li class="chapter-item expanded "><a href="api/lesan_fn.html"><strong aria-hidden="true">30.</strong> lesan</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/schemas/schemas_fn.html"><strong aria-hidden="true">30.1.</strong> schemas</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/schemas/schemaFns/schemaFns_fn.html"><strong aria-hidden="true">30.1.1.</strong> schemaFns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/schemas/schemaFns/getSchemas_fn.html"><strong aria-hidden="true">30.1.1.1.</strong> getSchemas</a></li><li class="chapter-item expanded "><a href="api/schemas/schemaFns/getPureOfMainRelations_fn.html"><strong aria-hidden="true">30.1.1.2.</strong> getPureOfMainRelations</a></li><li class="chapter-item expanded "><a href="api/schemas/schemaFns/getSchema_fn.html"><strong aria-hidden="true">30.1.1.3.</strong> getSchema</a></li><li class="chapter-item expanded "><a href="api/schemas/schemaFns/getPureSchema_fn.html"><strong aria-hidden="true">30.1.1.4.</strong> getPureSchema</a></li><li class="chapter-item expanded "><a href="api/schemas/schemaFns/getPureFromMainRelations_fn.html"><strong aria-hidden="true">30.1.1.5.</strong> getPureFromMainRelations</a></li><li class="chapter-item expanded "><a href="api/schemas/schemaFns/getPureFromRelatedRelations_fn.html"><strong aria-hidden="true">30.1.1.6.</strong> getPureFromRelatedRelations</a></li><li class="chapter-item expanded "><a href="api/schemas/schemaFns/createEmbedded_fn.html"><strong aria-hidden="true">30.1.1.7.</strong> createEmbedded</a></li><li class="chapter-item expanded "><a href="api/schemas/schemaFns/createStruct_fn.html"><strong aria-hidden="true">30.1.1.8.</strong> createStruct</a></li><li class="chapter-item expanded "><a href="api/schemas/schemaFns/_fn.html"><strong aria-hidden="true">30.1.1.9.</strong> getSchemasKeys</a></li></ol></li><li class="chapter-item expanded "><a href="api/schemas/mainRelationsFns/mainRelations_Fns.html"><strong aria-hidden="true">30.1.2.</strong> mainRelationsFns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/schemas/mainRelationsFns/getMainRelations_fn.html"><strong aria-hidden="true">30.1.2.1.</strong> getMainRelations</a></li></ol></li><li class="chapter-item expanded "><a href="api/schemas/relatedRelationFns/relatedRelation_Fns.html"><strong aria-hidden="true">30.1.3.</strong> relatedRelationFns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/schemas/relatedRelationFns/getRelatedRelations_fn.html"><strong aria-hidden="true">30.1.3.1.</strong> getRelatedRelations</a></li></ol></li><li class="chapter-item expanded "><a href="api/schemas/pureFns/pure_Fns.html"><strong aria-hidden="true">30.1.4.</strong> pureFns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/schemas/pureFns/addPureModel_Fns.html"><strong aria-hidden="true">30.1.4.1.</strong> addPureModel</a></li><li class="chapter-item expanded "><a href="api/schemas/pureFns/getPureModel_Fns.html"><strong aria-hidden="true">30.1.4.2.</strong> getPureModel</a></li><li class="chapter-item expanded "><a href="api/schemas/pureFns/getPureModelByNameAndKey_Fns.html"><strong aria-hidden="true">30.1.4.3.</strong> getPureModelByNameAndKey</a></li></ol></li><li class="chapter-item expanded "><a href="api/schemas/relationFns/relation_Fns.html"><strong aria-hidden="true">30.1.5.</strong> relationFns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/schemas/relationFns/getRelation_Fns.html"><strong aria-hidden="true">30.1.5.1.</strong> getRelation</a></li></ol></li><li class="chapter-item expanded "><a href="api/schemas/selectStructFns/selectStruct_Fns.html"><strong aria-hidden="true">30.1.6.</strong> selectStructFns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/schemas/selectStructFns/fieldType_Fns.html"><strong aria-hidden="true">30.1.6.1.</strong> fieldType</a></li><li class="chapter-item expanded "><a href="api/schemas/selectStructFns/decreaseIterate_Fns.html"><strong aria-hidden="true">30.1.6.2.</strong> decreaseIterate</a></li><li class="chapter-item expanded "><a href="api/schemas/selectStructFns/checkRelation_Fns.html"><strong aria-hidden="true">30.1.6.3.</strong> checkRelation</a></li><li class="chapter-item expanded "><a href="api/schemas/selectStructFns/selectStruct_Fns.html"><strong aria-hidden="true">30.1.6.4.</strong> selectStruct</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="api/acts/acts_fn.html"><strong aria-hidden="true">30.2.</strong> acts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/acts/setAct/setAct_Fns.html"><strong aria-hidden="true">30.2.1.</strong> setAct</a></li><li class="chapter-item expanded "><a href="api/acts/getServiceKeys/getServiceKeys_Fns.html"><strong aria-hidden="true">30.2.2.</strong> getServiceKeys</a></li><li class="chapter-item expanded "><a href="api/acts/getActs/getActs_Fns.html"><strong aria-hidden="true">30.2.3.</strong> getActs</a></li><li class="chapter-item expanded "><a href="api/acts/getActsKeys/getActsKeys_Fns.html"><strong aria-hidden="true">30.2.4.</strong> getActsKeys</a></li><li class="chapter-item expanded "><a href="api/acts/getAct/getAct_Fns.html"><strong aria-hidden="true">30.2.5.</strong> getAct</a></li><li class="chapter-item expanded "><a href="api/acts/getAtcsWithServices/getAtcsWithServices_Fns.html"><strong aria-hidden="true">30.2.6.</strong> getAtcsWithServices</a></li><li class="chapter-item expanded "><a href="api/acts/getMainActs/getMainActs_Fns.html"><strong aria-hidden="true">30.2.7.</strong> getMainActs</a></li><li class="chapter-item expanded "><a href="api/acts/getMainAct/getMainAct_Fns.html"><strong aria-hidden="true">30.2.8.</strong> getMainAct</a></li><li class="chapter-item expanded "><a href="api/acts/setService/setService_Fns.html"><strong aria-hidden="true">30.2.9.</strong> setService</a></li><li class="chapter-item expanded "><a href="api/acts/getService/getService_Fns.html"><strong aria-hidden="true">30.2.10.</strong>   getService</a></li></ol></li><li class="chapter-item expanded "><a href="api/odm/odm_fn.html"><strong aria-hidden="true">30.3.</strong> odm</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/odm/setDb/setDb_Fns.html"><strong aria-hidden="true">30.3.1.</strong> setDb</a></li><li class="chapter-item expanded "><a href="api/odm/getCollection/getCollection_Fns.html"><strong aria-hidden="true">30.3.2.</strong> getCollection</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/newModel_Fns.html"><strong aria-hidden="true">30.3.3.</strong> newModel</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/odm/newModel/find_Fns.html"><strong aria-hidden="true">30.3.3.1.</strong> find</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/findOne_Fns.html"><strong aria-hidden="true">30.3.3.2.</strong> findOne</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/insertOne_Fns.html"><strong aria-hidden="true">30.3.3.3.</strong> insertOne</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/insertMany_Fns.html"><strong aria-hidden="true">30.3.3.4.</strong> insertMany</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/addRelation_Fns.html"><strong aria-hidden="true">30.3.3.5.</strong> addRelation</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/removeRelation_Fns.html"><strong aria-hidden="true">30.3.3.6.</strong> removeRelation</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/findOneAndUpdate_Fns.html"><strong aria-hidden="true">30.3.3.7.</strong> findOneAndUpdate</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/deleteOne_Fns.html"><strong aria-hidden="true">30.3.3.8.</strong> deleteOne</a></li><li class="chapter-item expanded "><a href="api/odm/newModel/aggregation_Fns.html"><strong aria-hidden="true">30.3.3.9.</strong> aggregation</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="api/context/contextFns_fn.html"><strong aria-hidden="true">30.4.</strong> contextFns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/context/getContextModel/getContextModel_Fns.html"><strong aria-hidden="true">30.4.1.</strong> getContextModel</a></li><li class="chapter-item expanded "><a href="api/context/setContext/setContext_Fns.html"><strong aria-hidden="true">30.4.2.</strong> setContext</a></li><li class="chapter-item expanded "><a href="api/context/getContextModel/addContexts_Fns.html"><strong aria-hidden="true">30.4.3.</strong> addContexts</a></li><li class="chapter-item expanded "><a href="api/context/getContextModel/addReqToContext_Fns.html"><strong aria-hidden="true">30.4.4.</strong> addReqToContext</a></li><li class="chapter-item expanded "><a href="api/context/getContextModel/addHeaderToContext_Fns.html"><strong aria-hidden="true">30.4.5.</strong> addHeaderToContext</a></li><li class="chapter-item expanded "><a href="api/context/getContextModel/addBodyToContext_Fns.html"><strong aria-hidden="true">30.4.6.</strong> addBodyToContext</a></li></ol></li><li class="chapter-item expanded "><a href="api/runServer/runServer_fn.html"><strong aria-hidden="true">30.5.</strong> runServer</a></li><li class="chapter-item expanded "><a href="api/generateSchema/generateSchemTypes_fn.html"><strong aria-hidden="true">30.6.</strong> generateSchemTypes</a></li></ol></li><li class="chapter-item expanded "><a href="api/types/main.html"><strong aria-hidden="true">31.</strong> types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/types/schema/main.html"><strong aria-hidden="true">31.1.</strong> schema types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/types/schema/model.html"><strong aria-hidden="true">31.1.1.</strong> model types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/types/schema/model/TRelation.html"><strong aria-hidden="true">31.1.1.1.</strong> TRelation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/types/schema/model/TRelation/RelationDataType.html"><strong aria-hidden="true">31.1.1.1.1.</strong> RelationDataType</a></li><li class="chapter-item expanded "><a href="api/types/schema/model/TRelation/RelationSortOrderType.html"><strong aria-hidden="true">31.1.1.1.2.</strong> RelationSortOrderType</a></li><li class="chapter-item expanded "><a href="api/types/schema/model/TRelation/TRelatedRelation.html"><strong aria-hidden="true">31.1.1.1.3.</strong> TRelatedRelation</a></li></ol></li><li class="chapter-item expanded "><a href="api/types/schema/model/IMainRelation.html"><strong aria-hidden="true">31.1.1.2.</strong> IMainRelation</a></li><li class="chapter-item expanded "><a href="api/types/schema/model/IRelatedRelation.html"><strong aria-hidden="true">31.1.1.3.</strong> IRelatedRelation</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="api/types/Services/main.html"><strong aria-hidden="true">31.2.</strong> Services types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/types/Services/Acts.html"><strong aria-hidden="true">31.2.1.</strong> Acts types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/types/Services/Acts/Act.html"><strong aria-hidden="true">31.2.1.1.</strong> Act</a></li></ol></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Lesan</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/MiaadTeam/lesan" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/MiaadTeam/lesan/tree/main/pages/src/Lesan&#x27;s_Solution_For_How_To_Communicate_Between_The_Server_And_The_Client.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="lesans-solution-for-how-to-communicate-between-the-server-and-the-client"><a class="header" href="#lesans-solution-for-how-to-communicate-between-the-server-and-the-client">Lesan's solution for how to communicate between the server and the client</a></h1>
<p>The idea of connecting <code>client-side</code> nodes to the backend in <strong>Lesan</strong> is inspired by <strong>GraphQL</strong>, but in <strong>Lesan</strong> we tried to make this connection simpler and more practical so that we can solve the problems mentioned above.</p>
<p>We focused on three points to do this:</p>
<ol>
<li>We do not add any language to the client and server (such as <code>GQL</code> language in GraphQL).</li>
<li>Instead of implementing complex logic to <code>filter</code> fields selected by the user, we use the logic implemented within databases (here <code>Aggregation</code> in MongoDB). Because algorithms implemented within databases have more scalability and efficiency due to direct data communication.</li>
<li>We store all relationships in data as <code>embedded</code> to reduce the amount of requests sent to the database.</li>
<li>Let’s create descriptive information for different types of data and how they are embedded in <code>server-side</code> logic so that we can create more efficient data models in the <code>NoSQL</code> style. We can also simplify data management in the database without changing the information.</li>
</ol>
<h2 id="proposed-method"><a class="header" href="#proposed-method">Proposed Method</a></h2>
<p>In the first step, we tried to organize the data structure because we intended to use <code>NoSQL</code> databases and at the same time we needed to have structured data like <code>SQL</code> both at runtime and during development to simplify the management of <code>embedded</code> data as much as possible.</p>
<p>We divided the relationships into two types of direct <code>(mainRelation)</code> and indirect <code>(relatedRelation)</code> for embedding. We stored direct relationships completely and stored indirect relationships only in the number that could be returned in the first request (first pagination). Each direct relationship can create several indirect relationships.</p>
<p>We exactly left the data retrieval management to the client as <code>MongoDB</code> had defined it, that is, sending an object with a key <code>(data name)</code> and a value <code>(0 or 1)</code> to the client.</p>
<p>We found a creative way to produce <code>Aggregation Pipelines</code> in MongoDB so that fewer documents are requested when receiving data as much as possible.</p>
<p>We allowed the client to see all the <code>models</code> and <code>functions</code> written on each model and choose them in the same object sent.</p>
<p>We allowed the client to see the <code>output</code> of each function written for each model along with the <code>exact depth</code> of its relationships that had previously been determined by the server-side programmer in a type-safe manner to make it easier to create the sent object.</p>
<p>We created an <code>ODM</code> to simplify the process of <code>receiving data</code> along with its <code>relationships</code> and also to manage the <code>repetitions</code> created from <code>embedded</code> relationships within this <code>ODM</code> so that the server-side programmer writes less code.</p>
<p>We prioritized input data <code>validation</code> and created a process for the server-side programmer to create a <code>validator</code> for each function written on each model so that we can run that <code>validator</code> before executing the <code>function</code>. In this validator, recursive data management along with the depth of penetration into the relationships of each model must be explicitly specified.</p>
<p>Let us clarify the issue with an example:
Let’s consider a schema named <code>country</code> with the following fields:</p>
<pre><code class="language-ts">id;
name;
abb;
description;
geoLocation;
capital;
provinces;
cities;
</code></pre>
<p>And also a schema for the <code>province</code> with the following fields:</p>
<pre><code class="language-typescript">id;
name;
abb;
description;
geoLocation;
center;
country;
cities;
</code></pre>
<p>And also a schema for the <code>city</code> with the following fields:</p>
<pre><code class="language-typescript">id;
name;
abb;
description;
geoLocation;
country;
province;
</code></pre>
<p>The <code>country</code> and <code>province</code> field in the <code>city</code> model and <code>country</code> field inside <code>province</code> model are of type <code>city</code> and <code>province</code> we compeletly <code>embed</code> them. This form of relationship is a direct relationship and we call it <code>mainRelation</code>, which ultimately is a single object of the <code>pure</code> city and province fields (<code>mainRelation</code> can also be multiple and be an array of objects) which is defined as follows:</p>
<pre><code class="language-ts">const cityRelations = {
  country: {
    optional: false,
    schemaName: &quot;country&quot;,
    type: &quot;single&quot; as RelationDataType,
  },
  province: {
    optional: false,
    schemaName: &quot;province&quot;,
    type: &quot;single&quot; as RelationDataType,
  },
};
const provinceRelations = {
  country: {
    optional: false,
    schemaName: &quot;country&quot;,
    type: &quot;single&quot; as RelationDataType,
  },
};

</code></pre>
<p>All <code>province</code> relationships do not end here. This schema also has a relationship with the <code>city</code>. With one simple question, we can complete the relationships:</p>
<p>Do these relationships that we have defined have an effect on the other side of the relationship?</p>
<p>Answer: yes, all these relationships will have effects on the other side as well. So we complete them like this:</p>
<pre><code class="language-typescript">const cityRelations = {
  country: {
    optional: false,
    schemaName: &quot;country&quot;,
    type: &quot;single&quot; as RelationDataType,
    relatedRelations: {
      cities: {
        type: &quot;multiple&quot; as RelationDataType,
        limit: 50,
        sort: {
          field: &quot;_id&quot;,
          order: &quot;desc&quot; as RelationSortOrderType,
        },
      },
    }
  },
  province: {
    optional: false,
    schemaName: &quot;province&quot;,
    type: &quot;single&quot; as RelationDataType,
    relatedRelations: {
      cities: {
        type: &quot;multiple&quot; as RelationDataType,
        limit: 50,
        sort: {
          field: &quot;_id&quot;,
          order: &quot;desc&quot; as RelationSortOrderType,
        },
      },
    }
  },
};
const provinceRelations = {
  country: {
    optional: false,
    schemaName: &quot;country&quot;,
    type: &quot;single&quot; as RelationDataType,
    relatedRelations: {
      provinces: {
        type: &quot;multiple&quot; as RelationDataType,
        limit: 50,
        sort: {
          field: &quot;_id&quot;,
          order: &quot;desc&quot; as RelationSortOrderType,
        },
      },
    }
  },
};
</code></pre>
<p>If you look carefully, a <code>relatedRelation</code> is defined for each relationship, which stores a <code>limited</code> number of this relationship on the other side.<br />
For example, we store <code>50 cities</code> in the <code>country</code> according to the <code>ID</code> of the cities and in <code>descending order</code>. And in the same way, we have done this for the <code>province</code>.</p>
<p>Now we have reached almost the same form as we defined schemas at first. The only remaining relationship is the relationship of <code>capital</code> in the <code>country</code>.<br />
We can define as many <code>relatedRelations</code> as we want for each direct relationship(<code>mainRelations</code>) we define.<br />
So we can add a new <code>relatedRelation</code> in the definition of city relationships where we have linked the country to the city:</p>
<pre><code class="language-ts">relatedRelations: {
  cities: {
    type: &quot;multiple&quot; as RelationDataType,
    limit: 50,
    sort: {
      field: &quot;_id&quot;,
      order: &quot;desc&quot; as RelationSortOrderType,
    },
  },
  capital: {
    type: &quot;single&quot;,
  },
}
</code></pre>
<p>Above we have only said that there is another relationship between city and country that a city can be the <code>capital</code> of a country. That is, the relationship is defined as <code>one-to-one</code>, unlike the relationship between <code>country</code> and <code>cities</code>, which is <code>one-to-many</code>. The relationship defined for the <code>center</code> of the <code>province</code> is exactly the same.</p>
<p>The complete and final form of relations is as follows:</p>
<pre><code class="language-typescript">// ----------- Direct and Indirect relations for city
const cityRelations = {
  country: {
    optional: false,
    schemaName: &quot;country&quot;,
    type: &quot;single&quot; as RelationDataType,
    relatedRelations: {
      cities: {
        type: &quot;multiple&quot; as RelationDataType,
        limit: 50,
        sort: {
          field: &quot;_id&quot;,
          order: &quot;desc&quot; as RelationSortOrderType,
        },
      },
      capital: {
        type: &quot;single&quot;,
      },
    }
  },
  province: {
    optional: false,
    schemaName: &quot;province&quot;,
    type: &quot;single&quot; as RelationDataType,
    relatedRelations: {
      cities: {
        type: &quot;multiple&quot; as RelationDataType,
        limit: 50,
        sort: {
          field: &quot;_id&quot;,
          order: &quot;desc&quot; as RelationSortOrderType,
        },
      },
      center: {
        type: &quot;single&quot;,
      },
    }
  },
};

// ----------- Direct and Indirect relations for province
const provinceRelations = {
  country: {
    optional: false,
    schemaName: &quot;country&quot;,
    type: &quot;single&quot; as RelationDataType,
    relatedRelations: {
      provinces: {
        type: &quot;multiple&quot; as RelationDataType,
        limit: 50,
        sort: {
          field: &quot;_id&quot;,
          order: &quot;desc&quot; as RelationSortOrderType,
        },
      },
    }
  },
};
</code></pre>
<p>We also define the rest of the fields that are not related to other schemas and are not actually a database relationship as <code>pure</code> fields.</p>
<pre><code class="language-ts">const countryPure = { name: string(), abb: optional(string()), ... }
</code></pre>
<p>Now, when creating a new document, whether it is a <code>city</code> document or a <code>province</code> document, you must also give it the relationships that are not optional (i.e. the <code>ID</code> of the relevant <code>country</code>) and on the other hand specify what effects this new document will have on the given relationship.<br />
For example, if we create a new <code>city</code>, will this city be added to the list of <code>cities</code> of the respective <code>country</code> or not, and will it be selected as the <code>capital</code> of that <code>country</code> or not?<br />
Read the <a href="./getting_start.html">Getting Started</a> section for more information.</p>
<p>It is also worth mentioning that we have not defined any relationship for the <code>country</code>. Only the <code>relatedRelations</code> of the <code>city</code> and the <code>province</code> have defined the relationship for the <code>country</code>.</p>
<p>Don't worry, you can easily see all the relationships, both <code>mainRelations</code> and <code>relatedRelations</code>, in <code>Playground</code>.
<img src="https://github.com/MiaadTeam/lesan/assets/6236123/ca6f37e0-1b6d-47a7-8033-c4d33dff178f" alt="Screenshot-2024-01-13-at-09-41-18-Lesan-Playground" /></p>
<p>It is worth noting that we save this form of defining schemas in the integrated runtime in an object called <code>Schemas</code>. We will discuss its structure further. But what is stored in the database is the initial form that we showed earlier. It means for the country:</p>
<pre><code class="language-typescript">id;
name;
abb;
description;
geoLocation;
capital;
provinces;
cities;
</code></pre>
<p>The amount of pure fields is known. And the value of the fields that are of the relation type of schemas will be in the form of <code>objects</code> or <code>array of objects</code> of the pure type of that relation. That is, for example, for the country:</p>
<pre><code class="language-ts">{
id: &quot;234fwee656&quot;,
name: &quot;iran&quot;,
abb: &quot;ir&quot;,
description: &quot;a big country in asia&quot;,
geoLocation : [ [12,4], [32,45], ... ],
capital : {
	id: &quot;234fwee656&quot;,
	name: &quot;tehran&quot;,
	abb: &quot;th&quot;,
	description: &quot;the beautiful city in middle of iran&quot;,
	geoLocation : [ [12,4], [32,45], ... ]
},
provinces : [{
	id: &quot;234fwee656&quot;,
	name: &quot;tehran&quot;,
	abb: &quot;th&quot;,
	description: &quot;one of the irans provinces&quot;,
	geoLocation : [ [12,4], [32,45], ... ]
	},
	{

	id: &quot;234fwee656&quot;,
	name: &quot;hamedan&quot;,
	abb: &quot;hm&quot;,
	description: &quot;one of the irans provinces&quot;,
	geoLocation : [ [12,4], [32,45], ... ]
},
... til to end of the provinces
}],
cities :  [{
		id: &quot;234fwee656&quot;,
	name: &quot;tehran&quot;,
	abb: &quot;th&quot;,
	description: &quot;the beautiful city in middle of iran&quot;,
	geoLocation : [ [12,4], [32,45], ... ]
	},
	{
		Id: &quot;234fwee656&quot;,
	name: &quot;hamedan&quot;,
	abb: &quot;hm&quot;,
	description: &quot;one of the irans cities&quot;,
	geoLocation : [ [12,4], [32,45], ... ]
},
... til to end of the number limit for the first paginate
}],
</code></pre>
<p>Now the user can filter and receive all the fields of a schema along with the first depth of its relations by sending only one request to the database.</p>
<p>This request is performed based on the process of <code>projection</code> in MongoDB according to the values of fields being <code>one</code> or <code>zero</code>. Without our framework having any involvement in this process. And without us writing an additional layer to filter the requested fields in it. (The process and form of this request will be explained later.)</p>
<p>If the lower fields of a country’s schema are requested in a request, not only all the requested information will be received and returned to the user with <code>one</code> request to the <code>server</code> but also with <code>one</code> request to the <code>database</code>.</p>
<p>If the following fields are requested from the schema of a country in a request. Not only with a <code>single</code> request to the <code>server</code> but also with a <code>single</code> request to the <code>database</code>, all requested information will be received and returned to the user:</p>
<pre><code class="language-ts">// getCountry REQUEST
{
    id: 1,
    Name: 1,
    abb: 1,
    decsription: 1,
    capital: {
        id: 1,
        name: 1,
        abb : 1
    },
    provinces: {
        id :1,
        name : 1,
        description : 1
    },
    cities: {
        id : 1,
        name : 1,
        abb : 1
    }
}
</code></pre>
<p>If a user penetrates more than one level of depth, what should be done? For example, if they request provinces for a country, they may also want its <code>cities</code> from within the <code>provinces</code>.</p>
<pre><code class="language-ts">// getCountry REQUEST
{
    id: 1,
    Name: 1,
    abb: 1,
    decsription: 1,
    capital: {
        id: 1,
        name: 1,
        abb : 1
    },
    provinces: {
        id :1,
        name : 1,
        description : 1,
        cities: {
            id : 1,
            name : 1,
            abb : 1
        }
    },
    cities: {
        id : 1,
        name : 1,
        abb : 1
    }
}

</code></pre>
<p>Let’s examine what happens in <code>SQL</code> databases before we explain the <code>Lesan</code> framework solution:</p>
<ul>
<li>
<p>First of all, we run a query to find the <code>country</code>, because we have the country <code>ID</code>, we run an <code>indexed</code> query.</p>
</li>
<li>
<p>After that, we run a query to find the <code>capital</code>, because we have its <code>ID</code> stored in the country, we run an <code>indexed</code> query.</p>
</li>
<li>
<p>Then we send a query to find the first paginate of <code>provinces</code>. If we have stored the <code>ID</code> of all the provinces of a country inside it, we run an indexed query. Otherwise, we must send an <code>non-index</code> query with the country ID filter found.</p>
</li>
<li>
<p>Continuing with the example, if we had found <code>30</code> of the first paginate <code>provinces</code>. We should send a <code>non-index</code> query with a province <code>ID</code> filter for each one on each city and find the first paginated <code>cities</code> for each of the provinces. (For example, <code>50</code> for each province, which means <code>50</code> times <code>30</code>)</p>
</li>
<li>
<p>Finally, to find the first paginate <code>cities</code> for this country too, we need to send a <code>non-index</code> query with the <code>ID</code> filter of the found <code>country</code> on the city table</p>
</li>
</ul>
<p>You saw that the process was very complicated in <code>SQL</code>, now let’s see how the same process is done in <code>Lesan</code>.</p>
<p>In the previous section, we mentioned that to get a country along with the <code>first</code> depth of its relationships (i.e., <code>capital</code>, <code>provinces</code>, and <code>cities</code>), we only send an <code>indexed</code> query to the schema of the country and receive all the information.</p>
<p>Now we only need to receive information about <code>cities</code> for each <code>province</code>.</p>
<p>To do this, while we have access to the information of the <code>provinces</code>, we send an <code>indexed</code> query to receive the <code>provinces</code> again.</p>
<p>Because of the concept of relations in <code>Lesan</code>, we are sure that the information of <code>cities</code> is stored within <code>provinces</code>. Therefore, by receiving the <code>provinces</code> again, we will also receive the information of <code>cities</code>.</p>
<p>This will have two advantages for us. First, instead of sending a <code>non-index</code> query to the <code>city</code>, we send an <code>index</code> query to the <code>province</code> because we have received the province <code>IDs</code> in the first query.The second advantage is that instead of receiving a large number of <code>cities</code>, we have only received a few <code>provinces</code>. (For example, in <code>SQL</code>, the number of requested documents from the database is equal to <code>1 + 1 + (30 * 50) + 50</code>. But in the <code>Lesan</code> method, only <code>1 + 35</code> documents have been requested.)</p>
<p>Now imagine what would happen if more depth and relationships were requested? This is the Achilles' heel of projects written with <code>GraphQL</code>.</p>
<h2 id="why-duplicate-data"><a class="header" href="#why-duplicate-data">Why duplicate data?</a></h2>
<p>As you noticed in the above example, if we can store all the dependencies of a table inside it, we can significantly reduce the number of <code>requests</code> sent to the <code>database</code>. This number is remarkably large. For example, in one of the best cases, if we have a table with <code>10</code> dependencies, each dependency is related to <code>10</code> other tables and all relationships are <code>many-to-many</code>. If we want to receive a list of <code>50</code> items from that table along with 2 steps of penetration into its relationships with <code>one</code> request, in <code>SQL</code> we should send <code>50 * 10 * 50 * 10</code> which is equivalent to <code>250000</code> (two hundred and fifty thousand) requests sent to the <code>database</code>. But in <code>Lesan</code> all this data is collected with only <code>50 * 10</code> which is equivalent to <code>500</code> requests sent to the <code>database</code>.</p>
<h2 id="the-ratio-of-creation-and-update-to-data-retrieval"><a class="header" href="#the-ratio-of-creation-and-update-to-data-retrieval">The Ratio Of Creation And Update To Data Retrieval</a></h2>
<p>Imagine a news <code>database</code>. We need a table for the <code>authors</code> and another table for the <code>news</code> written. Usually, at the end of each news, the <code>name</code> and some information of the <code>author</code> of that news are also included. If we place the information we need for the <code>author</code> of that news inside the news at the time of <code>creation</code>, we will not need to send a separate request to the <code>database</code> to receive the information of the <code>author</code> of that news when reading each news. But the problem arises when the author <code>updates</code> their information. For example, if they change their name from <code>Ali</code> to <code>Ali Akbar</code>. In this case, we have to update all the <code>news</code> written by that author. If this author writes an average of <code>10</code> news per day and works on this news website for more than <code>5 years</code>, at least <code>18250</code> documents in the database must be <code>updated</code>. Is this cost-effective? In general, and in most cases, it can be cost-effective because news can be read more than a few <code>thousand</code> times a <code>day</code> and on the other hand, each author only changes their information <code>once a year</code>. Therefore, updating <code>18250</code> documents once a year is much less expensive than reading information from two different tables <code>millions</code> of times a day. Moreover, we have created a different solution for <code>updating</code> these repetitions called <code>QQ</code>, which updates them based on the amount of hardware resources used by the server side in different time periods and based on the value of the data. This process will be fully explained later.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="Previous_methods_and_the_main_challenge.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="Why_NoSQL.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="Previous_methods_and_the_main_challenge.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="Why_NoSQL.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
